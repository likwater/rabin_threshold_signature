from dilithium_py.ml_dsa import ML_DSA_44, ML_DSA_65, ML_DSA_87
import time

# For MLDSA44 y is 128 bits, MLDSA65 y is 192 bits and for MLDSA87 y is 256 bits.
# start = time.time()
# end = time.time()

# create key
def creating_key(level:int):
    if level == 1:
        ML_DSA = ML_DSA_44
    elif level == 2:
        ML_DSA = ML_DSA_65
    elif level == 3:
        ML_DSA = ML_DSA_87
    else:
        # 中断程序，报错：ValueError: Unsupported level
        raise ValueError("Unsupported level")
    pk, sk, sk_list = ML_DSA.keygen()
    # for i in range(6):
    #     print(len(sk_list[i]), end=" ")
    # print()
    return sk, pk

# signing
def signature(level:int, msg:bytes, sk:bytes):
    if level == 1:
        ML_DSA = ML_DSA_44
    elif level == 2:
        ML_DSA = ML_DSA_65
    elif level == 3:
        ML_DSA = ML_DSA_87
    else:
        raise ValueError("Unsupported level")
    sig = ML_DSA.sign(sk, msg)
    return sig

# check
def check(level:int, sig:str, pk:bytes, msg:bytes):
    if level == 1:
        ML_DSA = ML_DSA_44
        if len(sig) != 2420:
            return False
    elif level == 2:
        ML_DSA = ML_DSA_65
        if len(sig) != 3309:
            return False
    elif level == 3:
        ML_DSA = ML_DSA_87
        if len(sig) != 4627:
            return False
    else:
        raise ValueError("Unsupported level")
    if ML_DSA.verify(pk, msg, sig) == False:
        return False
    return True

if __name__ == "__main__":

    # for i in range(10):
    #     secure_level = 2
    #     _, _ = creating_key(secure_level)
    sk, pk = creating_key(2)
    # print(sk)
    # sk = b'\x80\x89\xb3\rAN}in\x122\xd9J\x9c^\x05}U\xda#]V\x9f\xaf\xa0+\xc1\x82/\xeb\xb5\xa6C6\xfdC\xe3\x85\xd18 \x15\x08\x92l\x9e\x17\x93\xf8\xfcm6\xb9\xcflP?\x1e\xf7\xab\xde\xab\x99oi\x83Kgo\x9dl}\x16\x15\x9aeR\xcf\x04\x17\xfck/i\xcf\x84C\xcf \x9d\xec\x1ck\xd2\x87}\xf9\xee\x86\x01J\x03/\xc6x\xb5\x19"`\xee\xc0\x90\x98\xd5B_49\xaf\x7f=\xeb\xe6\xb8t\x98\x9c\xaaQ\x80d\x1127\x15U4s(\x12QTd5\x81\x14@b\x83G`4%u\x17AvqW\x07vra\x18\x17Qc\x88Q\x157SQ\'\x86(@urc\x14Rc\x06(fR%G&\x86F\'7CC\x16gExQB7eF\x82hu@EU\x06uxx\x13\x02dd\x13G\x80p\x02\x03q\x13tEt%W\x01BB`pBH!TCr\x00\x11@&\x14\x04\x10\x15\x830\x14t$`50V\x81\x00PE\x01\x85W\x847Fx4\x82S0q\x87fF&$c7Paw1VE`B\x08b&X\x06u\x17G\x04\x13Ws03\x8535xg\x10!E\'cRT\x142\x868\'!vxfarUg\x07\x00pWAS1\x18\x10\x00\x14DbVC"p\x02\x14\x01\x17E4r\x01\x82"`\x042C\x028c\x84b\x82\x05\x05\x85h$hc\x113AC3%r`\x830\x87\x13c&\x07EH7RT1rX\x84\x176!U \x03p$G5b\x05\x16\x84u\x04XPUBfHx`cC7\x03U2B@\x84$77\x88\x178$x\x16 7d$H\x87(TSP\x05\x17\x83g3e\x13\x07Rv4U\'H\x02\x17Q\x12(Q\x17!v\x805\x07\x04QP\x18\x85f&!\x00@vu737C\x85#P@WSx"\x01$\x00d!wt\x077\x05b\x08\'#UW\x871HP@Gv1@\x82(@\x84\x16\x15"#v2V6\x80R2@\x82\x05x\x836ht\x138x\x04#\x87d\x15 8\x01H\x85\x86S6FpE#\x00sP5DwD\x02$\x80\x01cX\x03\x82x\x01\x86%\x86dF%\x100\x88\x82\x03\x152sdW\x82h\x04u\x87\x16qsQ2ghH4e1BV\x04\x84\x85g24GC\x18W\x07Xu\x08\x80\x86%C7$\x80r\x81RX\x01vc"C\x80gG\x052\x88U\x82\x18D\x08\x16\x06\x05f\x18$\x07\x06U4\x17`axB\x88&\x13\x13A\x05CRUR&x3\x16ess\x8246\x12S!\x08xB%#\x83aRH\x07PDRU\x016U@5`\x103%\x17\x03@\x85UPB\x81\x11h\x80\x07\x06WT\x00H\x04\x13Ch\x12ED1\x16&AG\x83SF\'"\x18PT\x02q\x18aW\x86sS\x11\x08#\'`P3u\x83Re5S4B3r%H\x166f(\x00aD\x001% #e\x05tTh\x85xb\x85q3\x82qHP\x01!w3\x83Hp1\x17P"XuD!\x82\x05uc5p\x83\x02D\x06WG&\x14\x13v25F\x86&W\x14 PVTB"5`UH\x13\x87\x07\x16P`\x14\x10g\x11c\x116SU\x17fs65\x10VG7v0\x81D\x857x\x156pq\x85\x08\x80\x85!0U\x16Pvb%\x04DX$t\x01\x047tRhC313B\x11\x03\x16\x80\x846W3Q5\x00G@&f\x807b@\x86`U\x84\x8541P&\x05\x05`\x80\x12W\x02\x16\x063A5r\x87bCG\x07\x85R\x85\x11EX\x85p\'\x81`Gas\x858\x88S7\'\x07B\x86QXC`\x100\x06\x80Xw\x01RG\x85B\x00xb\x12\x07\x13E`T\x01\x83Qe\x17Ew\x01\x11\x13d\x87\x82\'S3\x865X\x82QFFf6\x12\x11wa\x17e\x11 \x13AaaShpUqe\x17\x84%\x106E\x02\x83C\x83U2\x02X\'%\'\x87\x03%$%W\x18Gt\x06f5tA8x\x05\x86\x012V\x04\x08w6FAuR1(XR\x17\x07p#e\x11C"55rF"&(E\x82\x065\x02\x07 fxS\x00x\x82B\x13hg\x06\x04xBG!fb\x80\x05PD(8\x86"\x07VD\x126\x88\x866S\'\x18cW\x828\x88&F`3\x87bpE\x12\x81\x05p7@@6\x03PT83 \x02GSD"\x07S3\x837vd%%f6!Q\x00XGUV S\x06\x02\x03C\x80\x15\x10@\x04 %&Xp\x10\x12\x16E\x15\x02\x14\x11\x172\x81\x8842a\x82!\x82\x83\x12g$Eh!8W\x88\x86#7\x88\x182\x80#@\x11#Wx"4g@#1CQ\x82pxw62\x83S\'R\x826@e\x84u((c(fP\x83\x01rUWw\x046Bepwv1rpHXs\x15t D\x83f\x17\x80GB3\x80\x88W\x08tt$Gd\x06"\x02 a1\x13AUg7\x08\x02x\x08\x88%@\x85su6E\x876x8\x10F\x16wEXQr\x18&8\x06\x10\x02GfRu4D\x86DX078cG\x84\x07chx\x14\x10@\x81\x02!\x82b\x828\x114\x85V0\x14\x83\x00\x814\x06\x07hPap\x806B`\x07 QVR@0\x18aq\x82v\x18Q4\x10\x158C\x85gg\x00P\x88`\x02\x84A2\x04wb@\x01\x11D2\x81h\x01s\'t#\x18\x84F\x81(3!!W 1%uWA\x03HT0(eE\'\x87\x01R\x05\x82\x878XT4V\x03\x06(U6Q\x85(\x08\x15`$6c&"q\x86gW!\x15HR\x18\x14\x7f>\xa3\xc6\x14\xe8\xbd\xc8\xa4\xeaX\x91\xa9\xf1\xcc\xad\x07$D\xc3Y.\xbc\xf4)\x85\x10|\x0c\x9fg#J\xe1\x15\xe9\xff\x9d\xda>\x01>+/\x1e\x1c\xc22\xa0\x1b*\xb17\xea07\xa5\xc9:2\xe4M\xc8\xc9\x855\x8c\x1c\xafd\x1er\x9d\x9d\xe4\x1d\xf7\x13\xa2,\xe1(\xdd\x97@\xb9\x00\xc9\xc8>\x85\x9d6,\x88m\x1e\xce\x85\x9cG\x11o\xb2\x89\xb5\xbc\x95\xcd\x94\xda\x9fg\xf8\x1f\xee\x13\x946\x9f\xec\xfd|HH\x12fH\x1f\xaf\x98\xef\n\x16T\xaa\xae\xac\x08i\xf3OJ\xa8\xd6\xa1\xd0\x00\xf4\xbd\x8a\x1c[\x06(\xd2`"\xeb[\xff\x92\x7f\x1b\x0e\xbfQ\x92\xccj\xe9M\xe1\x04\x0c\xd3\xd8\xdb\xccm\xf5k:\xe7\xf8R\xf6\xc7"\xdf\n\x04n\xeers.M\xd5\xe2\xd3\xee\xe3\x83\xe5\x02\x0e\xb3\xdd\x15d\xca\xfd\x04,\xa8l\xf0\xa3o\xfe(8Ld\xdbe\xc8C\xc5^\x021\xb4\x7fi\n\xdc\x10\xd7MqN:u\xbc\x82\x11\x90Y\xa8\x11F\xc2?\t\xc8\xf6{\xe0\x8f\xeb\x03\x9egD\x97k\x1a;\xd8\xb7:b\xd1\x91\xbf\xdb\x84\xa6\x04\xcae\xeb\x11J\xce\xcbb\xbd\x7f2\xe4.\xb8\x0e<^H\xac\xab\xd0\xefx\x03\xfb\x1f\xd0\xf1\xf1\x0b\xf9t\xa8\x19\xcd1S.\xfff\x923E\x95<ag\xa7v\'\x97\xd8\xae\xfeH\x05\x81\xb9\x95\x87woM\xae\xa7\xc8-e?\x9d\x8a\xa9\x99\xc81_\xb7\x03j0\x8d6T\xfb\x90\xc0\xe5\xd8\xfc\xa5\xdep\x17>\xa5Y\x08\xb6G\xf0\x8bw\xf50}\xa76$j\xed\xd6VC7\xf5J\xf8\x14\x80h7\xf4\xcb\xe9\xcd\xab\xa3\xf9\xba\x83\xd9\x95\t\xf6\xcdz\xd7O\x1c\x9fX\x1ff\xc4\xcbf\x9a\x08\xf6f\xc5>\x18\xdb\xd5j\x0cQ\xc9\x83\x8bX\xce\x9b\xac\x82\xc9\x06\xae\x83\x85\x15\t\xcfe\xd3W\xda\x86\xe0\xcf\x93\x03f\x8c\xb3%\x8d\xe7/\x99\xa0\x92\x96t*\x9d\x85$\xe9\x05\xa3Y\xc9\rd]\xfe\xa2\x08\x95\xceATD\x1d\xc0\x93\xfd[\xe9\x7f-z\xfb\x8d\xcf\xd9\xad\x856\t\xccF\xbcQ<\xc3U\xcb\x98\xf4\xd9\xef\x0ep<9\x1fr\x10\xad\x94\xf5@\x19\xb9[\xf7\x0b\xcf\xcf\xee\x06\xcck\x80\xf3\xb5\x1dg\xb1\xa5\xbe\xd3\xa9\x97Z\xc4< \xab\xbe\x97\x17\xc5C\x80L\xa1\x88\xd3\x9b\xd6+I\x1e\xfew\xc0\xa3\x17\xaa\xbc#}\xa1\x932=\xee\x1a+\xa6\xb7\xb4\x8ddN\xccvD\xe5\xaaj\xc1\x84\x936//\xe1\xc9\xd9$\x99\xd7hW\xacj\\\xbf\xa8\xe1i\x9dI\x11\x10\xb2\x19[\x1f\x8b\xfe\xb4\xbe,*\xa2\xaf\x1c\xbb\xe1\x930%;_\xe4JsW7<o\xc9U\xd9\xf3\x81\xd5F*\x86\xe03\xfd+oa\xae\x03`x\xf4\xb6\xc9\x83B\x16\x89T\x00\x88\xe1\xd0\xea\x97\xdd\xbe\xd1\xc2\xf7y\xe8\xaf\xa5\xe0\x9d\xbb\xbaX\xbf\xa4\xb6V1\xed\xb3p\xb8wG\xf6\x96c\xb4\xf4:\x9e\x17\xcd7\xcb\x9b\x171=^\x1aA\x12vP\xca\xaa\xcf\x80\xbc\x88\x1c8\x15\xe3\x03\\J5\xf2t\nZ\xe8\xa9\xfd\x07\xf0\x08\xa1\xb9\xcb\xea4\xde\xa8\x04}\xd4Y\x9e\x84\x15\x1aX\xd9\xc0{\xc2eE\xa0\x0fY>E\x80\xfcpn\xd2\xb4\xd7L\xcbe\xa2H\xd8\xfe\xa2A\xd4\x0f\xc5\x88\xc7\xafODv:N\x9c\xf6\xdb\x8ba\xe1\x0b\x10:\xae\x17\xaf$\xca\x05/"\xb9\x00\xf5\xb1\x94s\xed\x98-\xb4\x8b\xf0\x17,\xab\x11\r\xf8N\x97\x81\xafC\xbe\x19\xc1\xc7N\x94z\x8e\x87\xe7\xb0\x02N\xe8[P\x14\xf7&\x14\xf8\x8a\xbe\x89\xa0(\xdcb\x19F!4\xf2&\x82e\xda%\x12\x15\xf9\xee\xb5{\x91\xc2\x03\x9fx)J\xef\x96wl\x03\xc5\xf5\x81\xb5r[\xb2\xff\x0e\x1f6\xda\xcc\xa9\xa4\xc6\x18\xf7\xff\x8ae>\xc3\xb3\xa1\x99\xf8 `\x91\xa7+;\x9d\x97 p`\xce\xcd\xdf\xce\x87\xbd\x0f\x90\xc1pA\x0f\x93\x98D\xb3\xbd\x88n\x86\x8a\x04\xda\xb5\xcax\x9c-\x8c\xa0M\xab\xa0s\x13\x0bA%J\x83\xf3\x95T\xfcg\xe2{\xfc\xa4M\xffix\x15\xe6t`\xb9\x82}\xd0J\xb3\xf4+\x95W9.\x12\x8c\xa1\x89\x9eb\xea)\xf3\xa1\xd6H\xfb\r&)+\xb5 \xc5a.Kx&u7?.\xdb{\xbe+\xf1\xb0\x19\x9f\x11\xc7\xe4\xdb\x9f\xf5"\xa6\x91\x06\x8f\xe12\xf7\xf2\xdb\x17\x9f\x1d\x01lH\x1d\xc3\xb1A\x7f0\xd52\xf8\xe4c#\x13F\xc8\xf1\x1e\xce>\xce\x1dJ\xc1\xe4hx\x93co\xb3u6\xbc\xe77\xb8\xe7\x94\x91\x00\xdbP04\x88\x9d\x907\xb3\xa4\x90\x03u\xa9\x1a\xae\xaa\xc1w\xbb@\xa8\xc7\xbfC\xd0a>O\xfe\xd2\xfc\x1bc\xe5D9i\xa6\x8c\xe9\x94\x88\x7f\xac\xbb\x7fM\xb7\xecc\xf7\xdf(\xb8j\xf4K5z\xf0wE\xea\x8c\x1fK\xed\x95Y(O\xbd\x02q\xdb\'\x82\x06&{\xb0-\x10\xd76m\xd5~\xa0\x07T\xcc\x98\xab`\x85\xd9Q\xa7L\x080\x0f\x8d\xa9\x0ca\x19\xaa\xcc\xb0\x8f\xa7\x99#\x1eL\xcfM\x87\xa0/\xae6\xcf\xce\xad\xd8n\xd8\xde\xa6\xdca\xd1\xf3\x9c\xc6\x9bW\xb6\xcf\xde#U\xd1#$\x80\xc0\xaa\xd1\xdc\x9cl\xd7z$\xbd\x94M\xd7\xe4\xc7\xb7@I\'\x03\x89\xc8h\x89\x0b\xd6\x97\x9b\xc5}\xca\x18\x13`Ltk\xf6f\xb3{LBU9F\xc4|\xd2~\x85\xf0\xd3\x9aN\x03\xb8.V,\x1dI\xf1\x8bM\xbc\xde\xba@\x9b\x19\xf4`tW!GU\xcd\xf5P\xc9\x11\xe2[-\x02\x81\x01\x819\x15\x06.(\xfe\x11Zk\xa2\xb3\xa39x#\xd5PZ\r\x88Q_\xa6\xa0\xb4Zl\x98\x8f\x92\xc2\x9bOf\xb0\xc4L\xbb\x81\x9a\x9c\xdaO\x8bO\xcc\x97\xcfU$h.\x90\x10\x7fm\xd5\x82^\x1f\xd9\xcd1aKf\xba\xc2m\x90\xe2\x03\xe4\xe1\xcb-\xfb\xa1\xe4\xe9\x84u\x95D\x8a\x0e?\xa1\n@\x14\xc4\xaa\xbdN\x1b\xe1\xa0g\xf1\xfax%(\xa2%=\x0b\x08\xc59\xed\xd8J\xf8\x8a\xe3\xc7_\xee\xf0\xf1\xa0\x03\xfc7\x7fO$\xa3\xf8@\x9e\x05\x1b#\x9f^\xe4D\x11\x11\xf3A\xfb\xe4j\xb1\xfd\xffO<\xc9||N\x04\rX\xf1\xa4\xd8O\xf1\x12\xba\x87\x1d\x9e\x87\x1c\x82\xd5@\xbf\xe1\xc6;\xef\xf7Mh\x13\xfa\x15\xf4\xe8\x8aVJI\x90\xa9\x04\xd9l\x89\xe2`\x12\x04\xeb\xdc\xa2\t\xba\x91\xcf\xf7\x82\xd0D\x8dA\xe6\x93}\x95\xa7\xffg.\x0c\x85\xacv\x1a\x08\xf34L\xce{\xcd\njbB\xef\x83\xa59|T\xeb+`\x82(\x81\xf6\x86\xb6\x9f\x93E\xcd\x1aWe\xb0\xb9\xbfJ\xed\xc3\x96\x9d\x10\xce\x8e<N\xcelb\x8fa-C\xd7\xc5}\xec_Qqd5\xce\'v&0\xcc3M\xfeO6_\x17\xbctb\xa0\x0c\xc6\xee?\xf9g\x07\xfc.s\x93b0L\xac\xb2\xaf9\xc2Y\xe4\x8f\xa1\x19\x98\xc5\xd9M$\xf7Ou\xd0\xc7\xf0\x13\xa4.\x80\xa3\xd3\x82\x1b\xafZ\xa9\xd6\xe4\xc7\xdc\xe5\xf7cA\x06\xd5\'G\x0f\xce\x91\xb5\xe8L\xe7\x7f\x17\xbae\xb5\xd3\x9f)\x8a\x93\xd8\x92L\\V\x98a\\kL\xf4A\x91\xd8-G\xe1\xd4E\xe8:b\xccH\xcb\xec\x02\xd3JKt\xc6"n\xe8\xf1\xc2\xed\xa8\x9d\xb9\xba\x0c\x03#I<]\xc3\x0f|\xd095\xd2\xee&2\n\x0e_\x97\xfa\x18\xe5\x85zo\'\x95{\xd8\niH\xa6\xea\xaf\xa3L\xc7i\xdb\x00\x0e\x92\xa8\x92i\xfeEi(k\x9d\xe5\n^r\xe8\xede\xd1\xa7\xd8\xb7\xdd%\xe3\xe1-\xb0\xa7\x93\xe5q\xdd\xa8\xf8\x99)#\xd0\xcb\xcb\xcb+e\x10{a\xda-\xa7\x85\xdc4\x9f)p^\xe1U\xbc\xa5\xc1\x9a\x94\xc0\x91\x9c:\xe7\xe0\xbc"\xde\xaa\xe8\x9d\xcb\xff\x0e8\xb7\x9f\x12\xa7\xaf[\x1e\xedy\xb0(\x82\x10\xb3W/x\xc7G\x7fT\x9d\xe8p\x90|\x8b\x8a\xdcF\xc2\xc7P}@I\xed\xb9\xd8\xb9\xc3\xe3yT=W, \xeb\x8a\x1cl\nrz;\x95\xed\xb0[\xd0l\xfd%c>\x92\xb5}\xe8\xa0|\xa0\xa1\x8d\xd9\xf2t\xda\xef\x8e\xf7\x88^@\xa1\xa9\xc7\x06\xd9JoA\xc2x\xdf\x15:\x0f\x02\xcct?\xb7;\x90B|\xac\xbf\xc1o\xed9\xe1C\xf25\x8fE\xd7\xea~%\x1b\r\xff\xb2J\xbc\x98)\t\xb7L\xe8y\t-\xae\xdb\t\xd7i\xe2a\xbbY\x08`{\x15\xab\xa3\xb4\x98\xfcn\xc1\xa6\xfb`x\xcd\x00\xff\x9c\xc2Al\xde\x84\x12\xb1|\x87\xf9@\xc1\xf3\x1a\xfate\xf5\xd1\xf1\xfbk8\xc8\xa4_7!\xabe\x13\x83\x9dY}\xa8\x9f\'BVb(7?\xc3\x86\xd0\x14\xf3BF\x1f\xf9\xbc\x8e\xf9\xa3\x81\xa3\x08\x99\x1a\x83\xbdR\xa6\xdc\xbe\xd8\x02&X\xf8E_\xd8\x10u\xe3\x9e\x16\xe4\xfc\xdd\x9c\xdcg\xdb6\xd0\x13\x9b\xd1\xc8%J\xe7\xb3\x08\x9d\x94#\x87\xd4{\xfb\xc1\x8cJe\x9c\x1b\xc1e}\xa3\xbau\xe5\xac\xd1\xcc\x8cc}n<^\xf0\xf1\xea-\x9fW\xce\xb7\xad\xd1\xd0\x8d\xea\xb4\xeb\x8bFt\xe4\x02\xfa\x9ea\xa5N\x11 \x98I\x86+~E<\xfa\x97\xfdI\xbdP\x94\x9a8\x97\x9e\xc9\xcc\xe9\x87\xb4I\x9d%\xe4W\xf9\xf1UmR\xdd+/q\xf0zC!\xa18\xa2kC\x97\x98\xc9\xa8\xbe\x98\x8d3d\xfe\xf9\xf5\xcb\x13[\xaa%\xbb\x81\x9e\x83m\x80\xe2\xb1\'~\xfd\xe9\xa4\xf8S\xf070\t\x0b\xd7\xc6\xc0O\xb9\x83\xaa\x03\xfe\xfe\xec\xe00 \xe9\xb3\xc6&\x82\x87\xe444>w\xfb\xd3\x8a\x18\xdf\xe8q\xe5\xdf\x88)\xc0\x82\x86g\x07\x9c\xa3\x96\xb4\xf5\xb5vd\x06\xd2\xb9\xc2\x02\xa34\x87\xc0Q\xc1\x98\xd9\xae\xe2\x00\xa1\xebM\t\x02\x08\xffo\xea\x86\xc6\xe2\xd3\xa0\x94\xc1\xab\xdf\x9fi\xdfu(s\xe95P\xc9\xb8<\xda[\xdbV<P\x14\x06\x00\xa9\xb2}\x88\xc8j\x96\xf9\x9d/\x16\x83\xc8\xbc\x97Q\xcf\xd3\xb3/\xfd\x1d\xa6\xe9\x82 !$\x11G\x865\xd8\x88\x1f\x94\xf2\x17<n\xe7\x8fU\x1f\xfan\xe8\x83<\x9b\x04\xcf\xfc~\xb7nO\xe8\x9fH\xee\xbf\x05\xca\xbfI\xf7r\x1d\x87\xcex*/\x7f\x909\xd2\x0b9\xbd\xcb'
    # 此处得到的签名sig中sig[0]=msg
    msg = b'123'
    sig = signature(2, msg, sk)
    print(sig)
    # # print(sig)
    check_result = check(2, sig, pk, msg)
    print(check_result)

